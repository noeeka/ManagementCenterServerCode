<!DOCTYPE html>
<html lang="en-US">
  <head>
    <title>Notice - text</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="ManagementCenterServer">
    <meta name="keywords" content="mcs">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><!--[if (gt IE 9)]><!-->
    <link rel="stylesheet" type="text/css" href="./assets/css/app.css"><!--<![endif]-->
    <!--[if (lte IE 9)]>
    <link rel="stylesheet" type="text/css" href="./assets/css/app-ie.css"><![endif]--> 
    <link rel="stylesheet" type="text/css" href="./assets/css/font-awesome.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/froala_editor.min.css">
    <link rel="stylesheet" type="text/css" href="./assets/css/wave.css">
  </head>
  <body>
    <div data-state="string_announcement" class="c-menu">
      <div class="c-folding"><img src="./assets/img/nav_icon_humberg2.png" alt="humberg"/></div>
      <div class="c-menu__content">
        <ul class="c-menu__content--parent">
          <li class="c-menu__single"><a href="./index.html">
              <div class="menu_img menu_homepage"></div>
              <p data-lang="string_homepage"></p></a></li>
          <li class="c-menu__hasChild"><a>
              <div class="menu_img menu_commu"></div>
              <p data-lang="string_communication"></p></a>
            <ul class="c-menu__content--child">
              <li>
                <p data-lang="string_communication"></p>
              </li>
              <li class="c-permission c-permission__intercom"><a href="./intercom_call.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_intercom_btn"></p></a></li>
              <li class="c-permission c-permission__intercom"><a href="./monitor.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_monitoring"></p></a></li>
              <li class="c-permission c-permission__notice"><a href="./notice_image.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_announcement"></p></a></li>
              <li class="c-permission c-permission__message"><a href="./message_send.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_message_btn"></p></a></li>
            </ul>
          </li>
          <li class="c-menu__hasChild c-permission c-permission__bookingDetail"><a>
              <div class="menu_img menu_booking"></div>
              <p data-lang="string_booking"></p></a>
            <ul class="c-menu__content--child">
              <li>
                <p data-lang="string_booking"></p>
              </li>
              <li><a href="./booking_venues_details.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_bookingSite"></p></a></li>
              <li><a href="./booking_activity_details.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_bookingActivities"></p></a></li>
            </ul>
          </li>
          <li class="c-menu__hasChild"><a>
              <div class="menu_img menu_data"></div>
              <p data-lang="string_basic"></p></a>
            <ul class="c-menu__content--child">
              <li>
                <p data-lang="string_basic"></p>
              </li>
              <li class="c-permission c-permission__infoEdit"><a href="./info_building.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_buildingInfo"></p></a></li>
              <li class="c-permission c-permission__infoEdit"><a href="./info_indoor.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_equipment"></p></a></li>
              <li class="c-permission c-permission__super"><a href="./sip_group.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_sipServer"></p></a></li>
              <li class="c-permission c-permission__infoSearch"><a href="./search_building.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_searchingData"></p></a></li>
              <li class="c-permission c-permission__online"><a href="./online_testing.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_jiance_btn"></p></a></li>
            </ul>
          </li>
          <li class="c-menu__single c-permission c-permission__alarm"><a href="./defense_record.html">
              <div class="menu_img menu_security"></div>
              <p data-lang="string_security"></p></a></li>
          <li class="c-menu__hasChild c-permission c-permission__super"><a>
              <div class="menu_img menu_more"></div>
              <p data-lang="string_more"></p></a>
            <ul class="c-menu__content--child">
              <li>
                <p data-lang="string_more"></p>
              </li>
              <li><a href="./user_position.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_managementId"></p></a></li>
              <li><a href="./device_management.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_deviceManagement"></p></a></li>
              <li><a href="./backup_restore.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_backup"></p></a></li>
              <li class="c-permission"><a href="./map_edit.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_mapEdit"></p></a></li>
              <li><a href="./setting_local.html">
                  <div class="menu_point"></div>
                  <p data-lang="string_setting"></p></a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <div class="c-content__right c-permission__page--notice">
      <div class="c-levelNav third-child">
        <ul>
          <li><a href="./notice_image.html" data-lang="string_noticeImage"></a></li>
          <li><a href="./notice_video.html" data-lang="string_noticeVideo"></a></li>
          <li><a href="./notice_text.html" data-lang="string_noticeText"></a></li>
          <li><a href="./notice_record.html" data-lang="string_noticeRecord"></a></li>
        </ul>
      </div>
      <div class="c-content c-notice">
        <div class="c-notice__list">
          <div class="c-notice__item c-notice__item--left">
            <p data-lang="string_editContent"></p>
          </div>
          <div class="c-notice__item c-notice__item--right">
            <textarea id="textarea" placeholder="Type something" oninput="checkBtn()" maxlength="200"></textarea>
          </div>
        </div>
        <div class="c-notice__list">
          <div class="c-notice__item c-notice__item--left">
            <p data-lang="string_editTime"></p>
          </div>
          <div class="c-notice__item c-notice__item--right c-notice__item--time">
            <p id="nowTime"></p><span style="vertical-align:middle; margin: 0 10px;" data-lang="string_text39"></span>
            <p id="limitTime">
              <select id="selectYear" onchange="selectDay()" class="c-select"></select><span>/</span>
              <select id="selectMonth" onchange="selectDay()" class="c-select"></select><span>/</span>
              <select id="selectDay" onclick="selectDay()" class="c-select"></select>
            </p>
          </div>
        </div>
        <div style="display:none" class="c-notice__list c-notice__list--btn">
          <div class="c-notice__item c-notice__item--left"></div>
          <div class="c-notice__item c-notice__item--right">
            <div id="openUploadBtn" data-lang="string_sendNotice" class="button button--orange"></div>
          </div>
        </div>
        <div id="popup__noticeSuccess" class="c-popup">
          <div class="c-popup__content">
            <div class="c-popup__content--nav"></div>
            <h3 data-lang="string_text27"></h3>
            <div class="c-popup__button">
              <div data-lang="string_confirm" class="button button--orange f-confirm"></div>
            </div>
          </div>
        </div>
        <div id="popup__send" class="c-popup">
          <div class="c-popup__content">
            <div style="margin-bottom: 10px" class="c-popup__content--nav">
              <div class="nav-close f-close"><i class="fa fa-times"></i></div>
            </div>
            <div class="c-notice__send">
              <div class="c-notice__batch">
                <h2 data-lang="string_outdoorList"></h2>
                <div class="c-notice__batch--outdoor"></div>
                <h2 data-lang="string_guardList"></h2>
                <div class="c-notice__batch--guard"></div>
                <div id="allCheck" data-lang="string_addAllAddressee" class="button button--white"></div>
                <div id="uploadBtn" data-lang="string_sendNotice" class="button button--orange disabled"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--include ./_footer--><!--[if (gt IE 9)]><!-->
    <script src="./assets/js/vendor/jquery.js"></script>
    <script src="./assets/js/vendor/jquery.nicescroll.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/jquery.cookie.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/jquery.i18n.properties.min.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/jquery.iframe-transport.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/jquery.ui.widget.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/jquery.fileupload.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/wave.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/mqttws.js" type="text/javascript"></script>
    <script src="./assets/js/vendor/qwebchannel.js" type="text/javascript"></script><!--<![endif]-->
    <!--[if (lte IE 9)]>
    <script src="./assets/js/vendor/old-ie/jquery-1.9.0.js"></script>
    <script src="./assets/js/vendor/old-ie/html5shiv.js"></script>
    <script src="./assets/js/vendor/old-ie/selectivizr-min.js"></script><![endif]-->
    <script src="./assets/js/vendor.min.js" type="text/javascript"></script>
    <script src="./assets/js/script.js" type="text/javascript"></script>
    <script src="./assets/js/app.min.js" type="text/javascript"></script>
    <script src="./assets/js/ajax.js" type="text/javascript"></script>
  </body>
  <script>
    var nowDate =  new Date();
    var nowYear = nowDate.getFullYear()
    var nowMonth = nowDate.getMonth()+1
    var nowDay = nowDate.getDate()
    var nowTime = nowYear + '/' + nowMonth + '/' + nowDay
    $('#nowTime').html(nowTime)
    
    var yearStr = '', 
        monthStr = '', 
        dayStr = '';
    for (var i = 0; i < 20; i++) {
      if (i == 0) {
        yearStr += "<option value='" + (nowYear + i) +"' selected='selected' >"+ (nowYear + i) +"</option>"
      }else{
        yearStr += "<option value='" + (nowYear + i) +"'>"+ (nowYear + i) +"</option>"
      }
    }
    
    for (var x = 0; x < 12; x++) {
      if (x + 1 == nowMonth) {
        monthStr += "<option value='" + (x + 1) +"' selected='selected'>"+ (x + 1) +"</option>"
      }else{
        monthStr += "<option value='"+ (x + 1) +"'>"+ (x + 1) +"</option>"
      }
    }
    dayStr += "<option value='"+ nowDay +"' selected='selected'>"+ nowDay +"</option>"
    $('#selectYear').html(yearStr)
    $('#selectMonth').html(monthStr)
    $('#selectDay').html(dayStr)
    selectDay()
    
    function checkBtn(){
      if ($('#textarea').val() != '') {
        $('.c-notice__list--btn').show()
      }else{
        $('.c-notice__list--btn').hide()
      }
    }
    
    $('#uploadBtn').click(function(){
      if ($(this).hasClass('disabled')) {
        return false
      }else{
        $('#popup__send').removeClass('is-active')
        var content = $('#textarea').val()
        var date = $('#selectYear').val() + '/'+ $('#selectMonth').val() + '/' + $('#selectDay').val()
        var member = []
        var box = $('.c-notice__batch--outdoor, .c-notice__batch--guard').find('.waves-button.is-active')
        box.each(function(){
          var memberData = {
            id: $(this).attr('data-id'),
            status: $(this).attr('data-state')
          }
          member.push(memberData)
        })
        $.ajax({
          url: _ajaxLink + "?c=Announcement&m=publishAnnouncement",
          type: "POST",
          data: {
            type: 2,
            content: content,
            deadline: date,
            username: getCookie('username'),
            target: member
          },
          async: false,
          dataType: "json",
          success: function(data){
            if (data.state == 1) {
              var edit_id;
              edit_id = window.location.href.split("?id=").pop();
              if (edit_id.indexOf("#") > 0) {
                edit_id = edit_id.split("#")
                edit_id = edit_id[0]
              }
              if(edit_id != '' && edit_id != null){
                removeNoticeRecord(edit_id)
              }
              $('#popup__noticeSuccess').addClass('is-active')
            }
          }
        })
      }
    })
    $('#popup__noticeSuccess .f-confirm').click(function(){
      location.reload()
    })
    var edit_id;
    if (window.location.href.indexOf("?id=") > 0) {
      edit_id = window.location.href.split("?id=").pop();
      if (edit_id.indexOf("#") > 0) {
        edit_id = edit_id.split("#")
        edit_id = edit_id[0]
      }
      $.ajax({
        url: _ajaxLink + "?c=Announcement&m=reviewInfo&id=" + edit_id,
        type: "GET",
        dataType: "json",
        async: false,
        success: function(data){
          if (data.state == 1 && data.ret != '') {
            $('#textarea').val(data.ret.content)
            var deadline = data.ret.deadline
            deadline = getLocalTime(deadline).split(' ')
            deadline = deadline[0].split('/')
            var year = deadline[0]
            var month = deadline[1]
            var day = deadline[2]
            $('#selectYear').find("option[value='"+ year +"']").attr('selected','selected')
            $('#selectMonth').find("option[value='"+ month +"']").attr('selected','selected')
            $('#selectDay').find("option").attr('value', day)
            $('#selectDay').find("option").html(day)
          }
        }
      })
    }
    
    //remove function
    function removeNoticeRecord(id){
      var id = id;
      $.ajax({
        url: _ajaxLink + "?c=Announcement&m=removeAnnouncement",
        type: "POST",
        data:{
          id: id
        },
        dataType: "json",
        success: function(data){
          if(data.state==1){
          }
        }
      })
    }
    
    var textAreaEnter= $('#textarea');  
    textAreaEnter.keypress(function (event) {
      var keycode = (event.keyCode ? event.keyCode : event.which);
      if (keycode == '13') {
        return false
      }
    });
    
    
    $('#openUploadBtn').click(function(){
      $('#popup__send').addClass('is-active')
      $('.c-notice__batch--outdoor, .c-notice__batch--guard').attr('data-lang', '')
      $('.c-notice__batch--outdoor, .c-notice__batch--guard').html('')
      $.ajax({
        url: _ajaxLink + "?c=Online&m=getAllGuardAndOutdoor",
        type: "GET",
        dataType: "json",
        async: false,
        success: function(data){
          if (data.state == 1 && data.ret != '') {
            $.each(data.ret, function (k, n) {
              var building = n.id[2] + n.id[3] + n.id[4]
              var block = n.id[5] + n.id[6]
              var number = n.id[7] + n.id[8] + n.id[9] + n.id[10]
              if (tem_lang == 'zh') {
                var device = building + '栋' + block + '单元' + number + '号'
              }else if (tem_lang == 'en') {
                var device = 'No.' + number + ' Blk' + block + ' Bld' + building
              }else if (tem_lang == 'hk') {
                var device = building + '棟' + block + '單元' + number + '號'
              }
              var deviceH = "<div data-state='"+ n.status +"' data-id='"+ n.id +"' onclick='checkNotice(this)' class='waves-effect waves-button onlineType"+ n.status +"'>"+ device +"</div>"
              if (n.type == '02') {
                $('.c-notice__batch--outdoor').append(deviceH)
              }else if (n.type == '07') {
                $('.c-notice__batch--guard').append(deviceH)
              }
            })
            if ($('.c-notice__batch--outdoor').html() == '') {
              $('.c-notice__batch--outdoor').attr('data-lang','string__noDevice')
            }
            if ($('.c-notice__batch--guard').html() == '') {
              $('.c-notice__batch--guard').attr('data-lang','string__noDevice')
            }
          }
          allLanguageRender()
        }
      })
    })
    
    function checkNotice(obj){
      var that = $(obj)
      that.toggleClass('is-active')
      checkChoose()
    }
    $('#allCheck').click(function(){
      var box = $('.c-notice__batch--outdoor, .c-notice__batch--guard').find('div')
      box.addClass('is-active')
      checkChoose()
    })
    
    function checkChoose(){
      var box = $('.c-notice__batch--outdoor, .c-notice__batch--guard').find('div.is-active')
      var len = box.length
      if (len == 0) {
        $('#uploadBtn').addClass('disabled')
      }else{
        $('#uploadBtn').removeClass('disabled')
      }
    }
    
    Waves.displayEffect();
  </script>
</html>